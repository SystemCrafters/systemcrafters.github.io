<!--  -->
<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta author="David Wilson"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="/css/bootstrap.min.css"/><link rel="stylesheet" href="/fonts/iosevka-aile/iosevka-aile.css"/><link rel="stylesheet" href="/fonts/jetbrains-mono/jetbrains-mono.css"/><link rel="stylesheet" href="/css/code.css"/><link rel="stylesheet" href="/css/site.css"/><script defer="defer" data-domain="systemcrafters.net" src="https://plausible.io/js/plausible.js"></script><title>System Crafters Live! - June 24, 2022 - System Crafters</title></head><body><div class="blog-header"><div class="container"><div class="row align-items-center justify-content-between"><div class="col-sm-12 col-md-8"><div class="blog-title">System Crafters</div></div><div class="col-sm col-md"><div class="blog-description text-sm-left text-md-right text-lg-right text-xl-right"></div></div></div></div></div><div class="blog-masthead"><div class="container"><div class="row align-items-center justify-content-between"><div class="col-sm-12 col-md-12"><nav class="nav"><a class="nav-link" href="/">Home</a> <a class="nav-link" href="/videos">Videos</a> <a class="nav-link" href="https://wiki.systemcrafters.net">Wiki</a> <a class="nav-link" href="https://store.systemcrafters.net?utm_source=sc-site-nav">Merch Store</a> <a class="nav-link" href="/support-the-channel">Support The Channel</a></nav></div></div></div></div><div class="container"><div class="row"><div class="col-sm-12 blog-main"><div class="blog-post"><h1 class="blog-post-title">System Crafters Live! - June 24, 2022</h1><p class="blog-post-meta"></p><div>
<h2><a id="updates" class="anchor" href="#updates">¶</a>Updates</h2><ul><li>I've replaced EXWM with HerbstluftWM in my configuration and I like it!</li>
<li>Next video will be about how I show "presentation" slides in Org Mode like in my videos</li>
</ul>

<h2><a id="configuring-herbstluftwm-with-emacs-lisp" class="anchor" href="#configuring-herbstluftwm-with-emacs-lisp">¶</a>Configuring HerbstluftWM with Emacs Lisp</h2><p>Today we're going to try and write an Emacs Lisp package that can control the venerable <a href="https://herbstluftwm.org/">Herbstluft Window Manager</a>.
</p>

<p>This is a really fun and versatile tiling window manager which (like <kbd>bspwm</kbd>) is configured through a command line interface called <kbd>herbstclient</kbd>.
</p>

<p>An interesting implication of how you configure <kbd>herbstluftwm</kbd> is that the configuration file can be written as a script in any language you like so long as it's at the expected configuration path (<kbd>~/.config/herbstluftwm/autostart</kbd>) and properly executable.
</p>

<p>Let's build the configuration package and try to write a simple configuration script in Emacs Lisp!
</p>

<p>Here are a few of the things we'll try to script:
</p>

<h3><a id="changing-settings-variables" class="anchor" href="#changing-settings-variables">¶</a>Changing settings variables</h3>

<h3><a id="setting-the-theme" class="anchor" href="#setting-the-theme">¶</a>Setting the theme</h3>

<h3><a id="configuring-key-bindings" class="anchor" href="#configuring-key-bindings">¶</a>Configuring key bindings</h3>

<h3><a id="workspace-management" class="anchor" href="#workspace-management">¶</a>Workspace management</h3>

<h3><a id="window-management" class="anchor" href="#window-management">¶</a>Window management</h3>

<h2><a id="the-final-code" class="anchor" href="#the-final-code">¶</a>The final code</h2><pre><code class="emacs-lisp">
(<span class="org-keyword">require</span> '<span class="org-constant">cl-lib</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">herbst-run-command</span> (command)
  (start-process-shell-command <span class="org-string">"herbstclient"</span>
                               nil
                               (format <span class="org-string">"herbstclient %s"</span> command)))

(<span class="org-keyword">defun</span> <span class="org-function-name">herbst-run-commands</span> (<span class="org-type">&amp;rest</span> commands)
  (mapcar #'herbst-run-command commands))

(<span class="org-keyword">defun</span> <span class="org-function-name">herbst-set</span> (setting-name value)
  (herbst-run-command (format  <span class="org-string">"set %s %s"</span> setting-name value)))

(herbst-set <span class="org-string">"frame_gap"</span> 10)

(<span class="org-keyword">defmacro</span> <span class="org-function-name">herbst-setq</span> (<span class="org-type">&amp;rest</span> setting-pairs)
  `(<span class="org-keyword">progn</span>
     ,@(<span class="org-keyword">cl-loop</span> for (key val) on setting-pairs by #'cddr collect
                `(herbst-run-command ,(format <span class="org-string">"set %s %s"</span>
                                              (string-replace <span class="org-string">"-"</span> <span class="org-string">"_"</span> (symbol-name key))
                                              val)))))

(<span class="org-keyword">defmacro</span> <span class="org-function-name">herbst-set-attr</span> (<span class="org-type">&amp;rest</span> attr-lists)
  `(herbst-run-commands ,@(herbst--attr-list-to-strings <span class="org-string">""</span> attr-lists)))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Building up the object path</span>

(<span class="org-keyword">defun</span> <span class="org-function-name">herbst--attr-list-to-strings</span> (current-path current-item)
  (<span class="org-keyword">if</span> current-item
      (<span class="org-keyword">if</span> (listp (car current-item))
          <span class="org-comment-delimiter">;; </span><span class="org-comment">This needs to loop</span>
          (apply #'append
                 (mapcar (<span class="org-keyword">lambda</span> (item)
                           (herbst--attr-list-to-strings current-path item))
                         current-item))
        (<span class="org-keyword">if</span> (keywordp (car current-item))
            (append
             (list (format <span class="org-string">"attr %s%s %s"</span>
                           current-path
                           (string-replace <span class="org-string">"-"</span>
                                           <span class="org-string">"_"</span>
                                           (substring (symbol-name (car current-item)) 1))
                           (cadr current-item)))
             (herbst--attr-list-to-strings current-path (cddr current-item)))
          (<span class="org-keyword">if</span> (symbolp (car current-item))
              (herbst--attr-list-to-strings
               (concat current-path
                       (symbol-name (car current-item))
                       <span class="org-string">"."</span>)
               (cdr current-item)))))
    '()))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Speculative key binding syntax</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(herbst-define-key "S-c" "cycle"</span>
<span class="org-comment-delimiter">;;                    </span><span class="org-comment">"S-i" "jumpto urgent"</span>
<span class="org-comment-delimiter">;;                    </span><span class="org-comment">"S-q" "close_and_remove")</span>

(<span class="org-keyword">provide</span> '<span class="org-constant">herbstmacs</span>)

</code></pre>

<p>The <kbd>autostart</kbd> file:
</p>

<pre><code class="emacs-lisp">
#!/usr/bin/env -S emacs -Q --script

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: Don't harcode this path!</span>
(load <span class="org-string">"~/Projects/Code/herbstmacs/herbstmacs.el"</span>)

(herbst-setq frame-gap 10
             window-gap 0
             smart-frame-surroundings off)

(herbst-set-attr
 (theme <span class="org-builtin">:title-font</span> <span class="org-string">"'JetBrains Mono:pixelsize=32'"</span>
        <span class="org-builtin">:title-height</span> 40
        <span class="org-builtin">:title-depth</span> 15
        <span class="org-builtin">:outer-width</span> 3
        (floating <span class="org-builtin">:border-width</span> 4
                  <span class="org-builtin">:outer-width</span> 1
                  <span class="org-builtin">:outer-color</span> black)
        (urgent <span class="org-builtin">:inner-color</span> <span class="org-string">"#9A65B0"</span>)))

</code></pre>
</div></div></div></div></div><footer class="blog-footer"><div class="container"><div class="row"><div class="col-sm col-md text-sm-left text-md-right text-lg-right text-xl-right"><p>Made with Emacs 27.2 (Org mode 9.4.4)</p><p><a href="https://systemcrafters.net/privacy-policy/">Privacy Policy</a></p></div></div></div></footer><script src="/js/bootstrap.bundle.min.js"/></body></html>
