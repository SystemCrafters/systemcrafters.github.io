<!DOCTYPE html><html lang="en"><head>&lt;!--  --&gt;<meta charset="utf-8"/><meta author="David Wilson"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="/css/bootstrap.min.css"/><link rel="stylesheet" href="/fonts/iosevka-aile/iosevka-aile.css"/><link rel="stylesheet" href="/fonts/jetbrains-mono/jetbrains-mono.css"/><link rel="stylesheet" href="/css/code.css"/><link rel="stylesheet" href="/css/site.css"/><script defer="defer" data-domain="systemcrafters.net" src="https://plausible.io/js/plausible.js"></script><title>Clean Your Commits Like a Git Rebase Expert with Magit - System Crafters</title></head><body><div class="blog-header"><div class="container"><div class="row align-items-center justify-content-between"><div class="col-sm-12 col-md-8"><div class="blog-title">System Crafters</div></div><div class="col-sm col-md"><div class="blog-description text-sm-left text-md-right text-lg-right text-xl-right"></div></div></div></div></div><div class="blog-masthead"><div class="container"><div class="row align-items-center justify-content-between"><div class="col-sm-12 col-md-12"><nav class="nav"><a class="nav-link" href="/">Home</a> <a class="nav-link" href="/videos">Videos</a> <a class="nav-link" href="https://wiki.systemcrafters.net">Wiki</a> <a class="nav-link" href="https://store.systemcrafters.net?utm_source=sc-site-nav">Merch Store</a> <a class="nav-link" href="/support-the-channel">Support The Channel</a></nav></div></div></div></div><div class="container"><div class="row"><div class="col-sm-12 blog-main"><div class="blog-post"><h1 class="blog-post-title">Clean Your Commits Like a Git Rebase Expert with Magit</h1><p class="blog-post-meta"></p>&lt;div&gt;&lt;p&gt;&lt;a href=&quot;https://youtu.be/zM7K1y4h6UQ&quot;&gt;Watch the video&lt;/a&gt; on YouTube!
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;intro&quot; class=&quot;anchor&quot; href=&quot;#intro&quot;&gt;¶&lt;/a&gt;Intro&lt;/h2&gt;&lt;p&gt;Have you ever made a mistake or created sloppy commits when checking in changes to a Git repository?
&lt;/p&gt;

&lt;p&gt;After watching this video, you&apos;ll know exactly how to fix those problems and create a clean commit history with &lt;kbd&gt;git rebase&lt;/kbd&gt; and Magit.
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;support-the-channel&quot; class=&quot;anchor&quot; href=&quot;#support-the-channel&quot;&gt;¶&lt;/a&gt;Support the Channel&lt;/h2&gt;&lt;p&gt;The content on this channel is supported by the System Crafters Community!
&lt;/p&gt;

&lt;p&gt;If you enjoy this video, please click the &quot;Like&quot; button and check out the links below in the description to see other ways you can support my work!
&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://systemcrafters.net/support-the-channel&quot;&gt;https://systemcrafters.net/support-the-channel&lt;/a&gt;
&lt;a href=&quot;https://store.systemcrafters.net&quot;&gt;https://store.systemcrafters.net&lt;/a&gt;
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;getting-started&quot; class=&quot;anchor&quot; href=&quot;#getting-started&quot;&gt;¶&lt;/a&gt;Getting Started&lt;/h2&gt;&lt;p&gt;Make sure you&apos;ve got Magit installed first, check out the first video in the series for more information:
&lt;/p&gt;

&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://youtu.be/_zfvQkJsYwI&quot;&gt;An Introduction to the Ultimate Git Interface, Magit!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We&apos;ll be using the &lt;kbd&gt;magit-status&lt;/kbd&gt; interface a lot in this video!
&lt;/p&gt;

&lt;p&gt;I&apos;ve prepared an example repository that you can use to try the techniques I&apos;ll show you in this video, you can clone it here:
&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/SystemCrafters/filet-magit&quot;&gt;https://github.com/SystemCrafters/filet-magit&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;To make sure you&apos;re in the right branch when you clone this repository, use this command!
&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;sh&quot;&gt;
git clone https://github.com/SystemCrafters/filet-magit -b add-recipes

&lt;/code&gt;&lt;/pre&gt;

&lt;h2&gt;&lt;a id=&quot;reviewing-our-commits&quot; class=&quot;anchor&quot; href=&quot;#reviewing-our-commits&quot;&gt;¶&lt;/a&gt;Reviewing our commits&lt;/h2&gt;&lt;p&gt;Let&apos;s imagine that we&apos;re writing a cookbook package for Emacs.  We&apos;ve been working on a feature for adding new cookbook entries and we&apos;re just about ready to push those changes to the public repository.
&lt;/p&gt;

&lt;p&gt;But before we do that, let&apos;s take a look at our commit history and see if there&apos;s any cleanup work we want to do.
&lt;/p&gt;

&lt;p&gt;From a file within the project folder, we can run &lt;kbd&gt;M-x magit-status&lt;/kbd&gt; to pull up the status buffer.
&lt;/p&gt;

&lt;p&gt;We can take a look at the &quot;Recent commits&quot; section to review what we&apos;ve done so far.
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;weve-got-some-work-to-do&quot; class=&quot;anchor&quot; href=&quot;#weve-got-some-work-to-do&quot;&gt;¶&lt;/a&gt;We&apos;ve got some work to do&lt;/h2&gt;&lt;p&gt;We&apos;re going to clean up these commits using a feature of Git called &quot;interactive rebase&quot;.
&lt;/p&gt;

&lt;p&gt;This is a very powerful tool that allows you to edit commit history in a number of ways, so it&apos;s very important to know to use it if you work with Git a lot.
&lt;/p&gt;

&lt;p&gt;And as usual, Magit makes it much easier and more efficient to perform rebase operations than it would be on the command line.
&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; If you have changes to tracked files in your repo you will need to &lt;a href=&quot;https://systemcrafters.net/mastering-git-with-magit/everyday-git-workflow/#saving-local-changes-for-later&quot;&gt;stash them&lt;/a&gt; before proceeding!  (See &lt;a href=&quot;https://youtu.be/qPfJoeQCIvA?t=2176&quot;&gt;this video&lt;/a&gt; for an example).
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;an-important-tip&quot; class=&quot;anchor&quot; href=&quot;#an-important-tip&quot;&gt;¶&lt;/a&gt;An important tip!&lt;/h2&gt;&lt;p&gt;Here&apos;s something I recommend before doing any rebase operation if you&apos;re not that familiar with it yet.
&lt;/p&gt;

&lt;p&gt;Back up your branch before the rebase just to make sure you won&apos;t lose access to the original commits!
&lt;/p&gt;

&lt;p&gt;In the &lt;kbd&gt;magit-status&lt;/kbd&gt; buffer you can press &lt;kbd&gt;b n&lt;/kbd&gt; to create a new branch.  It will ask you the source branch and the name for the target branch.
&lt;/p&gt;

&lt;p&gt;Now that we have our backup branch, we can always get the original commits back if we make a mistake!
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;rewording-commits&quot; class=&quot;anchor&quot; href=&quot;#rewording-commits&quot;&gt;¶&lt;/a&gt;Rewording commits&lt;/h2&gt;&lt;p&gt;You can reword any commit in your branch&apos;s history by performing an interactive rebase using Magit.
&lt;/p&gt;

&lt;p&gt;In the &lt;kbd&gt;magit-status&lt;/kbd&gt; buffer, put your cursor on the commit you want to reword and press &lt;kbd&gt;r i&lt;/kbd&gt; (lower-case &lt;kbd&gt;R&lt;/kbd&gt; then &lt;kbd&gt;I&lt;/kbd&gt;).  This will bring up a rebase interface which displays the list of commits starting at the selected commit to allow you to pick which operation to take on each of them.
&lt;/p&gt;

&lt;p&gt;For the commit we want to reword, we can put our cursor on its line and press &lt;kbd&gt;r&lt;/kbd&gt; (lower-case &lt;kbd&gt;R&lt;/kbd&gt;) and it will be marked as &lt;kbd&gt;reword&lt;/kbd&gt;.  Press &lt;kbd&gt;C-c C-c&lt;/kbd&gt; to confirm.
&lt;/p&gt;

&lt;p&gt;You will now be given a commit message editing buffer to fix the wording of the commit.  Make your changes and press &lt;kbd&gt;C-c C-c&lt;/kbd&gt; to confirm.
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;you-just-changed-history&quot; class=&quot;anchor&quot; href=&quot;#you-just-changed-history&quot;&gt;¶&lt;/a&gt;You just changed history!&lt;/h2&gt;&lt;p&gt;Keep in mind that editing &lt;strong&gt;any&lt;/strong&gt; commit in the history will cause &lt;strong&gt;all following commits&lt;/strong&gt; to be recreated so they will all have a new commit hash!  This means that you will need to &quot;force push&quot; your changes to the remote repository if you have already pushed the branch there once before.
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;reordering-commits&quot; class=&quot;anchor&quot; href=&quot;#reordering-commits&quot;&gt;¶&lt;/a&gt;Reordering commits&lt;/h2&gt;&lt;p&gt;The commit history you create can be seen as the story of the code&apos;s creation.  Sometimes it makes sense for a more recent change to be moved back before other changes to improve the narrative.
&lt;/p&gt;

&lt;p&gt;You can reorder commits easily in the interactive rebase view by placing the cursor on a particular commit and using the following key bindings:
&lt;/p&gt;

&lt;ul&gt;&lt;li&gt;&lt;kbd&gt;M-n&lt;/kbd&gt; / &lt;kbd&gt;M-j&lt;/kbd&gt; (evil): Move the commit forward in time by one commit&lt;/li&gt;
&lt;li&gt;&lt;kbd&gt;M-p&lt;/kbd&gt; / &lt;kbd&gt;M-k&lt;/kbd&gt; (evil): Move the commit backward in time by one commit&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You can reorder multiple commits in one interactive rebase operation!
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;dealing-with-conflicts-when-moving-commits&quot; class=&quot;anchor&quot; href=&quot;#dealing-with-conflicts-when-moving-commits&quot;&gt;¶&lt;/a&gt;Dealing with conflicts when moving commits&lt;/h2&gt;&lt;p&gt;Now let&apos;s move another commit, but this time the move is going to create a conflict with the changes in the commit history.
&lt;/p&gt;

&lt;p&gt;We&apos;re going to move the commit titled &quot;Add function to make a cookbook entry&quot; to come just after the initial commit of the package code.
&lt;/p&gt;

&lt;p&gt;Since there&apos;s a conflict in the changes of both commits, we need to edit the file to resolve the issues.  Once we&apos;ve finished the edit the changes will be automatically staged and we can use &lt;kbd&gt;r r&lt;/kbd&gt; (two lower-case &apos;r&apos;) to continue the rebase.
&lt;/p&gt;

&lt;p&gt;We&apos;ll be asked to edit and confirm the commit message.  We don&apos;t need to add any changes so we can use &lt;kbd&gt;C-c C-c&lt;/kbd&gt; to complete the commit.
&lt;/p&gt;

&lt;p&gt;We&apos;ll also have to deal with another conflict!  Let&apos;s add the function back in the next commit and continue from there.
&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; If the merge is looking too complicated and you want to start over, you can use &lt;kbd&gt;r a&lt;/kbd&gt; to abort the current rebase!
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;editing-a-commit&quot; class=&quot;anchor&quot; href=&quot;#editing-a-commit&quot;&gt;¶&lt;/a&gt;Editing a commit&lt;/h2&gt;&lt;p&gt;We&apos;ll need to make a tweak to the following commit to restore the use of the new &lt;kbd&gt;filet-new-recipe&lt;/kbd&gt; in the &lt;kbd&gt;filet-add-recipe&lt;/kbd&gt; command since we had to remove it when resolving the previous conflicts.
&lt;/p&gt;

&lt;p&gt;Let&apos;s start a new interactive rebase and use the &lt;kbd&gt;edit&lt;/kbd&gt; command on that commit by pressing &lt;kbd&gt;e&lt;/kbd&gt; with the cursor on that line.
&lt;/p&gt;

&lt;p&gt;We can now go and change the code however we like and then stage those changes to be added to the existing commit.
&lt;/p&gt;

&lt;p&gt;In the &lt;kbd&gt;magit-status&lt;/kbd&gt; screen press &lt;kbd&gt;r r&lt;/kbd&gt; to complete the rebase operation.
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;combining-commits&quot; class=&quot;anchor&quot; href=&quot;#combining-commits&quot;&gt;¶&lt;/a&gt;Combining commits&lt;/h2&gt;&lt;p&gt;Now we&apos;re going to see how we can combine two commits together.  There are two ways to do this:
&lt;/p&gt;

&lt;ul&gt;&lt;li&gt;&lt;kbd&gt;fixup&lt;/kbd&gt;: Merges only the changes of a commit into the previous commit&lt;/li&gt;
&lt;li&gt;&lt;kbd&gt;squash&lt;/kbd&gt;: Merges the changes of a commit into the previous commit and combines their commits messages&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Use &lt;kbd&gt;fixup&lt;/kbd&gt; when you don&apos;t care about the commit message and &lt;kbd&gt;squash&lt;/kbd&gt; when you want to keep it!
&lt;/p&gt;

&lt;p&gt;We&apos;ll use &lt;kbd&gt;fixup&lt;/kbd&gt; to combine the &quot;oops&quot; commit into the initial package code commit and &lt;kbd&gt;squash&lt;/kbd&gt; to combine the two documentation commits and merge their messages.
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;deleting-commits&quot; class=&quot;anchor&quot; href=&quot;#deleting-commits&quot;&gt;¶&lt;/a&gt;Deleting commits&lt;/h2&gt;&lt;p&gt;Sometimes you will make temporary commits that are only useful for debugging purposes or maybe diagnosing a test failure in your CI runs.
&lt;/p&gt;

&lt;p&gt;Before you merge your branch, you will probably want to delete these commits!  Thankfully interactive rebase makes this easy.
&lt;/p&gt;

&lt;p&gt;Start a new interactive rebase at the commit that you want to delete.  We can press the &lt;kbd&gt;k&lt;/kbd&gt; key to use the &quot;drop&quot; operation on the temporary commit and then press &lt;kbd&gt;C-c C-c&lt;/kbd&gt; to confirm and then the commit will be deleted!  (&lt;kbd&gt;evil-collection&lt;/kbd&gt; users will need to press &lt;kbd&gt;d&lt;/kbd&gt; instead)
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;lets-do-it-all-at-once&quot; class=&quot;anchor&quot; href=&quot;#lets-do-it-all-at-once&quot;&gt;¶&lt;/a&gt;Let&apos;s do it all at once!&lt;/h2&gt;&lt;p&gt;Now that we know the whole flow, let&apos;s clean up the same commits all in one interactive rebase!
&lt;/p&gt;

&lt;p&gt;Here&apos;s the point where the backup branch we created becomes useful.
&lt;/p&gt;

&lt;p&gt;Inside the &lt;kbd&gt;magit-status&lt;/kbd&gt; screen we can press &lt;kbd&gt;X&lt;/kbd&gt; (capital letter &apos;X&apos;) to open the &quot;Reset&quot; panel.  &lt;kbd&gt;evil-collection&lt;/kbd&gt; users will need to press &lt;kbd&gt;O&lt;/kbd&gt; (capital letter &apos;O&apos;) instead!
&lt;/p&gt;

&lt;p&gt;We will then press &lt;kbd&gt;h&lt;/kbd&gt; (lower-cased &apos;H&apos;) to select the &quot;Hard&quot; option.  In this case, a hard reset will set our working tree back to the state of the source we select.
&lt;/p&gt;

&lt;p&gt;We can now select our &lt;kbd&gt;add-recipes-backup&lt;/kbd&gt; branch to reset the &lt;kbd&gt;add-recipes&lt;/kbd&gt; branch back to its previous history!
&lt;/p&gt;

&lt;p&gt;Now let&apos;s start the interactive rebase process again and perform all the changes we saw so far in one operation.
&lt;/p&gt;

&lt;h2&gt;&lt;a id=&quot;thats-it&quot; class=&quot;anchor&quot; href=&quot;#thats-it&quot;&gt;¶&lt;/a&gt;That&apos;s it!&lt;/h2&gt;&lt;p&gt;Let me know in the comments if this video was helpful or if you have any questions and don&apos;t forget to click the &quot;Like&quot; button!
&lt;/p&gt;
&lt;/div&gt;</div></div></div></div><footer class="blog-footer"><div class="container"><div class="row"><div class="col-sm col-md text-sm-left text-md-right text-lg-right text-xl-right"><p>Made with Emacs 27.2 (Org mode 9.4.4)</p><p><a href="https://systemcrafters.net/privacy-policy/">Privacy Policy</a></p></div></div></div></footer><script src="/js/bootstrap.bundle.min.js"/></body></html>
